<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Cookie Clicker mit Login, Skins & Safe</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
    <h1>Cookie Clicker Login</h1>
    <input type="text" id="usernameInput" placeholder="Username">
    <input type="password" id="passwordInput" placeholder="Passwort">
    <button id="loginBtn">Login / Registrieren</button>
    <p style="font-size:14px;color:#777;max-width:300px;text-align:center;">
Dieses Login ist nur für das Spiel gedacht.<br>
Bitte verwenden sie kein echtes Passwort!<br>
Ihre Sicherheit ist uns wichtig.
</p>

</div>

<!-- SPIELBEREICH -->
<div class="container" id="gameContainer" style="display:none;">

    <!-- Spielbereich -->
    <div class="game-area">
        <h1>Cookie Clicker</h1>
        <p class="score">Cookies: <span id="score">0</span></p>
        <p class="playtime">Spielzeit: <span id="playtime">00:00:00</span></p>

        <div class="per-click-display" id="perClick">
            Cookies pro Klick: <span id="perClickNumber">1</span>
        </div>

        <div class="mega-container" id="megaContainer">
            <svg class="progress-ring" width="100" height="100">
                <circle class="progress-ring__circle" stroke="#d6862e" stroke-width="8" fill="transparent" r="45" cx="50" cy="50"/>
            </svg>
            <span class="mega-timer" id="megaTimer"></span>
        </div>

        <div id="floatingContainer"></div>

        <button id="cookie">
            <div></div><div></div><div></div><div></div><div></div>
        </button>
    </div>

    <!-- SHOP -->
    <div class="shop">
        <h2>Shop</h2>

        <div class="shop-item">
            <p>Besserer Cookie (+1 pro Klick)</p>
            <p>Kosten: <span id="upgradeCost">50</span></p>
            <button id="buyUpgrade">Kaufen</button>
        </div>

        <div class="shop-item">
            <p>Mega Cookie (x2 pro Klick für 30 Sekunden)</p>
            <p>Kosten: <span id="megaCost">1000</span></p>
            <button id="buyMegaCookie">Kaufen</button>
        </div>

        <div class="shop-item" id="skinGreenShop">
            <div class="skin-preview green"></div>
            <p>Green Cookie Skin</p>
            <p>Kosten: 200</p>
            <button class="buySkin" data-skin="green" data-cost="200">Kaufen</button>
        </div>

        <div class="shop-item" id="skinTurquoiseShop">
            <div class="skin-preview turquoise"></div>
            <p>Turquoise Cookie Skin</p>
            <p>Kosten: 750</p>
            <button class="buySkin" data-skin="turquoise" data-cost="750">Kaufen</button>
        </div>

        <div class="shop-item" id="skinRedShop">
            <div class="skin-preview red"></div>
            <p>Red Cookie Skin</p>
            <p>Kosten: 1500</p>
            <button class="buySkin" data-skin="red" data-cost="1500">Kaufen</button>
        </div>

        <div class="shop-item" id="skinGoldShop">
            <div class="skin-preview gold"></div>
            <p>Golden Cookie Skin</p>
            <p>Kosten: 10000</p>
            <button class="buySkin" data-skin="gold" data-cost="10000">Kaufen</button>
        </div>

        <div class="shop-item" id="skinRainbowShop">
            <div class="skin-preview rainbow"></div>
            <p>Rainbow Cookie Skin</p>
            <p>Kosten: 50000</p>
            <button class="buySkin" data-skin="rainbow" data-cost="50000">Kaufen</button>
        </div>

        <!-- Safe -->
        <div class="shop-item" id="codeSafeSection">
            <p>Gib den Code ein:</p>
            <div id="codeDisplay">_ _ _ _ _ _</div>
            <div id="numberPad">
                <button class="numBtn">0</button><button class="numBtn">1</button><button class="numBtn">2</button>
                <button class="numBtn">3</button><button class="numBtn">4</button><button class="numBtn">5</button>
                <button class="numBtn">6</button><button class="numBtn">7</button><button class="numBtn">8</button>
                <button class="numBtn">9</button><button id="clearCode">C</button><button id="submitSafeCode">OK</button>
            </div>
        </div>

    </div>

    <!-- Skin Menü -->
    <div class="skin-menu">
        <h3>Cookie Skins</h3>
        <div id="skinsContainer">
            <button class="skin-btn active" data-skin="standard">Standard</button>
        </div>
    </div>

</div>

<script>
/* =================== LOGIN & USER DATA =================== */
let currentUserData = null;

function loadUserData(username){
    const data = localStorage.getItem("cookieUser_"+username);
    if(data) return JSON.parse(data);
    return {
        cookies:0,
        pointsPerClick:1,
        upgradeCost:50,
        megaUnlocked:false,
        megaCost:1000,
        skins:["standard"],
        activeSkin:"standard",
        usedCodes:[]
    };
}

function saveUserData(){
    if(currentUserData && currentUserData.username)
        localStorage.setItem("cookieUser_"+currentUserData.username, JSON.stringify(currentUserData));
}

document.getElementById("loginBtn").addEventListener("click",()=>{
    const username=document.getElementById("usernameInput").value.trim();
    const password=document.getElementById("passwordInput").value.trim();

    if(!username || !password){
        alert("Bitte Username und Passwort eingeben!");
        return;
    }

    if(password.length < 4){
        alert("Passwort muss mindestens 4 Zeichen lang sein.");
        return;
    }


    const stored = localStorage.getItem("cookieUser_"+username+"_pw");
 if(stored && stored !== btoa(password)){ alert("Falsches Passwort!"); return; }
if(!stored) localStorage.setItem("cookieUser_"+username+"_pw", btoa(password));


    currentUserData = loadUserData(username);
    currentUserData.username=username;

    document.getElementById("loginScreen").style.display="none";
    document.getElementById("gameContainer").style.display="flex";

    initGame();
});

/* =================== GAME LOGIC =================== */
let playtimeSeconds = 0;
let scoreDisplay, cookie, perClickDisplay, upgradeCostDisplay, buyUpgrade, buyMegaCookie, megaTimer, megaContainer, progressCircle, floatingContainer;
let megaDuration = 30, megaActive=false;

function initGame(){
    cookie=document.getElementById("cookie");
    scoreDisplay=document.getElementById("score");
    perClickDisplay=document.getElementById("perClickNumber");
    upgradeCostDisplay=document.getElementById("upgradeCost");
    buyUpgrade=document.getElementById("buyUpgrade");
    buyMegaCookie=document.getElementById("buyMegaCookie");
    megaTimer=document.getElementById("megaTimer");
    megaContainer=document.getElementById("megaContainer");
    progressCircle=document.querySelector(".progress-ring__circle");
    floatingContainer=document.getElementById("floatingContainer");

    // Spielzeit hochzählen
    setInterval(()=>{
        playtimeSeconds++;
        const h=Math.floor(playtimeSeconds/3600),
              m=Math.floor((playtimeSeconds%3600)/60),
              s=playtimeSeconds%60;
        const format=n=>String(n).padStart(2,"0");
        document.getElementById("playtime").textContent=`${format(h)}:${format(m)}:${format(s)}`;
    },1000);

    scoreDisplay.textContent=currentUserData.cookies;
    perClickDisplay.textContent=currentUserData.pointsPerClick;
    upgradeCostDisplay.textContent=currentUserData.upgradeCost;
    buyMegaCookie.disabled=currentUserData.megaUnlocked;

    updateSkinButtons();
    applyActiveSkin();

    cookie.addEventListener("click",cookieClick);
    buyUpgrade.addEventListener("click",buyUpgradeFunc);
    buyMegaCookie.addEventListener("click",buyMegaFunc);
    setupSafeCode();
    setupSkinShop();
}

/* =================== COOKIE CLICK =================== */
function cookieClick(e){
    currentUserData.cookies+=currentUserData.pointsPerClick;
    scoreDisplay.textContent=currentUserData.cookies;
    createFloatingCookie(currentUserData.pointsPerClick);
    createParticlesAtClick(e);
    saveUserData();
}

function createFloatingCookie(amount){
    const floatCookie=document.createElement("div");
    floatCookie.className="floating-cookie";
    floatCookie.textContent="+"+amount;
    const rect=cookie.getBoundingClientRect();
    const containerRect=floatingContainer.getBoundingClientRect();
    const randomX=Math.random()*60-30;
    const randomY=Math.random()*40-60;
    floatCookie.style.left=(rect.left+rect.width/2-containerRect.left-15+randomX)+"px";
    floatCookie.style.top=(rect.top-containerRect.top-30+randomY)+"px";
    floatingContainer.appendChild(floatCookie);
    setTimeout(()=>floatCookie.remove(),1000);
}



/* =================== UPGRADE =================== */
function buyUpgradeFunc(){
    if(currentUserData.cookies>=currentUserData.upgradeCost){
        currentUserData.cookies-=currentUserData.upgradeCost;
        currentUserData.pointsPerClick++;
        currentUserData.upgradeCost=Math.ceil(currentUserData.upgradeCost*1.5);
        scoreDisplay.textContent=currentUserData.cookies;
        perClickDisplay.textContent=currentUserData.pointsPerClick;
        upgradeCostDisplay.textContent=currentUserData.upgradeCost;
        saveUserData();
    } else alert("Nicht genug Cookies!");
}

/* =================== MEGA COOKIE =================== */
function buyMegaFunc(){
    if(megaActive){ alert("Mega Cookie läuft bereits!"); return; }
    if(currentUserData.cookies>=currentUserData.megaCost){
        currentUserData.cookies-=currentUserData.megaCost;
        scoreDisplay.textContent=currentUserData.cookies;

        const basePoints=currentUserData.pointsPerClick;
        currentUserData.pointsPerClick=basePoints*2;
        perClickDisplay.textContent=currentUserData.pointsPerClick;

        megaActive=true;
        buyMegaCookie.disabled=true;
        currentUserData.megaUnlocked=true;

        let remaining=megaDuration;
        megaTimer.textContent=remaining;
        megaContainer.style.display="block";

        const r=progressCircle.r.baseVal.value;
        const c=2*Math.PI*r;
        progressCircle.style.strokeDasharray=c;
        progressCircle.style.strokeDashoffset=c;

        const interval=setInterval(()=>{
            remaining--;
            megaTimer.textContent=remaining;
            progressCircle.style.strokeDashoffset=c-(remaining/megaDuration)*c;
            if(remaining<=0){
                clearInterval(interval);
                currentUserData.pointsPerClick=basePoints;
                perClickDisplay.textContent=currentUserData.pointsPerClick;
                megaContainer.style.display="none";
                megaActive=false;
                buyMegaCookie.disabled=false;
            }
        },1000);
        saveUserData();
    } else alert("Nicht genug Cookies!");
}

/* =================== SAFE-CODE =================== */
function setupSafeCode(){
    const safeCodes={"010203":1000,"121115":100000};
    let enteredCode="";
    const codeDisplay=document.getElementById("codeDisplay");
    const numButtons=document.querySelectorAll(".numBtn");
    const clearBtn=document.getElementById("clearCode");
    const submitSafeCode=document.getElementById("submitSafeCode");

    numButtons.forEach(btn=>btn.addEventListener("click",()=>{
        if(enteredCode.length<6){ enteredCode+=btn.textContent; updateDisplay(); }
    }));

    clearBtn.addEventListener("click",()=>{ enteredCode=""; updateDisplay(); });
    submitSafeCode.addEventListener("click",()=>{
        if(safeCodes.hasOwnProperty(enteredCode)){
            if(!currentUserData.usedCodes.includes(enteredCode)){
                currentUserData.cookies+=safeCodes[enteredCode];
                scoreDisplay.textContent=currentUserData.cookies;
                alert(`Code korrekt! Du hast ${safeCodes[enteredCode].toLocaleString()} Cookies erhalten.`);
                currentUserData.usedCodes.push(enteredCode);
                saveUserData();
            } else alert("Dieser Code wurde bereits verwendet!");
        } else alert("Falscher Code!");
        enteredCode="";
        updateDisplay();
    });

    function updateDisplay(){
        let displayText="";
        for(let i=0;i<6;i++){ displayText+=enteredCode[i]?enteredCode[i]:"_"; displayText+=" "; }
        codeDisplay.textContent=displayText.trim();
    }
}

/* =================== SKINS =================== */
function setupSkinShop(){
    document.querySelectorAll(".buySkin").forEach(btn=>{
        const skin = btn.dataset.skin;
        // Wenn der User die Skin schon hat, entferne den Shop-Item
        if(currentUserData.skins.includes(skin)){
            btn.closest(".shop-item").remove();
            return; // überspringe EventListener
        }

        btn.addEventListener("click", ()=>{
            const cost = Number(btn.dataset.cost);
            const shopItem = btn.closest(".shop-item");
            if(currentUserData.cookies >= cost){
                currentUserData.cookies -= cost;
                scoreDisplay.textContent = currentUserData.cookies;

                if(!currentUserData.skins.includes(skin)) currentUserData.skins.push(skin);

                shopItem.remove();
                updateSkinButtons();
                saveUserData();
            } else alert("Nicht genug Cookies!");
        });
    });

    // Skin Buttons (unten) wie vorher
    const skinsContainer=document.getElementById("skinsContainer");
    skinsContainer.addEventListener("click",(e)=>{
        if(e.target.classList.contains("skin-btn")){
            document.querySelectorAll(".skin-btn").forEach(b=>b.classList.remove("active"));
            e.target.classList.add("active");
            const skin=e.target.dataset.skin;
            currentUserData.activeSkin=skin;
            applyActiveSkin();
            saveUserData();
        }
    });
}


function updateSkinButtons(){
    const container=document.getElementById("skinsContainer");
    container.innerHTML="";
    currentUserData.skins.forEach(skin=>{
        const btn=document.createElement("button");
        btn.classList.add("skin-btn");
        btn.dataset.skin=skin;
        btn.textContent=skin.charAt(0).toUpperCase()+skin.slice(1);
        if(skin===currentUserData.activeSkin) btn.classList.add("active");
        container.appendChild(btn);
    });
}

function applyActiveSkin(){
    cookie.className="";
    if(currentUserData.activeSkin!=="standard") cookie.classList.add("skin-"+currentUserData.activeSkin);
}

let enterLocked = false;

document.addEventListener("keydown", (e) => {
    if (e.key !== "Enter") return;

    // ❗ verhindert Browser-Button-Spam
    e.preventDefault();

    if (enterLocked) return;
    enterLocked = true;

    // kein Klick beim Tippen in Inputs
    if (document.activeElement.tagName === "INPUT") return;

    const cookieBtn = document.getElementById("cookie");
    const gameVisible = document.getElementById("gameContainer").style.display !== "none";

    if (cookieBtn && gameVisible) {
        cookieBtn.click();
    }
});

document.addEventListener("keyup", (e) => {
    if (e.key === "Enter") {
        enterLocked = false;
    }
});

</script>

</body>
</html>

